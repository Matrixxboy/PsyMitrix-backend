<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personality Report Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            background-color: #f5f5f5;
            color: #333333;
        }
        .card {
            background: #ffffff;
            border: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .btn-primary {
            background-color: #4a90e2;
            border-color: #4a90e2;
        }
        .btn-primary:hover {
            background-color: #357abd;
            border-color: #357abd;
        }
        .text-primary {
            color: #4a90e2 !important;
        }
        h1, h2, h3, h4, h5, h6 {
            color: #4a90e2;
        }
    </style>
</head>
<body>

<div class="container mt-5">
    <div class="text-center mb-5">
        <h1 class="display-4">AI Personality Report Generator</h1>
        <p class="lead">Fill in your details to generate a comprehensive personality report.</p>
    </div>
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card p-5">
                <form id="reportForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="name" class="form-label">Name</label>
                            <input type="text" class="form-control" id="name" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="dob" class="form-label">Date of Birth</label>
                            <input type="date" class="form-control" id="dob" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="blood_group" class="form-label">Blood Group</label>
                            <input type="text" class="form-control" id="blood_group" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="older_siblings" class="form-label">Older Siblings</label>
                            <input type="number" class="form-control" id="older_siblings" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="younger_siblings" class="form-label">Younger Siblings</label>
                            <input type="number" class="form-control" id="younger_siblings" required>
                        </div>
                    </div>
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary btn-lg mt-4">Generate Report</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="reportSection" class="mt-5"></div>
    <div class="text-center mt-4 mb-5">
        <button id="downloadPdf" class="btn btn-primary btn-lg" style="display: none;">Download Report as PDF</button>
    </div>
</div>

<script>
    document.getElementById('reportForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const payload = {
            name: document.getElementById('name').value,
            gender: 'Male', // Can be extended later
            dob: document.getElementById('dob').value,
            blood_group: document.getElementById('blood_group').value,
            older_siblings: parseInt(document.getElementById('older_siblings').value),
            younger_siblings: parseInt(document.getElementById('younger_siblings').value)
        };

        const response = await fetch('http://127.0.0.1:8000/report/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });

        const data = await response.json();
        displayReport(data.report);
        document.getElementById('downloadPdf').style.display = 'inline-block';
    });

    function displayReport(report) {
        const reportSection = document.getElementById('reportSection');
        reportSection.innerHTML = `<h2 class="text-center display-5 mb-4">Report Summary</h2>`;

        report.sections.forEach(sec => {
            const sectionDiv = document.createElement('div');
            sectionDiv.className = 'card p-4 mb-4';
            sectionDiv.innerHTML = `<h3>${sec.title}</h3><p>${sec.content}</p>`;
            reportSection.appendChild(sectionDiv);
        });

        // Create charts
        createCharts(report.charts_data);
    }

    function createCharts(charts_data) {
        const reportSection = document.getElementById('reportSection');

        // Radar chart
        const radarChartDiv = document.createElement('div');
        radarChartDiv.className = 'card p-3 mb-3';
        reportSection.appendChild(radarChartDiv);

        const radarOptions = {
            chart: {
                type: 'radar',
                height: 350,
                toolbar: {
                    show: false
                }
            },
            series: [{
                name: 'Personality Traits',
                data: charts_data.radar_chart.values,
            }],
            xaxis: {
                categories: charts_data.radar_chart.labels
            },
            yaxis: {
                show: false
            },
            theme: {
                mode: 'light',
                palette: 'palette1'
            }
        };

        const radarChart = new ApexCharts(radarChartDiv, radarOptions);
        radarChart.render();

        // Bar chart
        const barChartDiv = document.createElement('div');
        barChartDiv.className = 'card p-3 mb-3';
        reportSection.appendChild(barChartDiv);

        const barOptions = {
            chart: {
                type: 'bar',
                height: 350,
                toolbar: {
                    show: false
                }
            },
            series: [{
                name: 'Scores',
                data: charts_data.bar_chart.values,
            }],
            xaxis: {
                categories: charts_data.bar_chart.labels
            },
            yaxis: {
                max: 10
            },
            theme: {
                mode: 'light',
                palette: 'palette1'
            }
        };

        const barChart = new ApexCharts(barChartDiv, barOptions);
        barChart.render();
    }

    document.getElementById('downloadPdf').addEventListener('click', () => {
        const { jsPDF } = window.jspdf;
        const reportSection = document.getElementById('reportSection');
        
        html2canvas(reportSection, { scale: 2 }).then(canvas => {
            const imgData = canvas.toDataURL('image/png');
            const pdf = new jsPDF('p', 'mm', 'a4');
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
            pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
            pdf.save("personality-report.pdf");
        });
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>